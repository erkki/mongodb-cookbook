# THIS FILE HAS BEEN GENERATED BY CHEF
# ANY MANUAL MODIFICATIONS WILL BE OVERWRITTEN
# mongodb.upstart.conf

<%
  @config = node[:mongodb][@server_type]
  @binary = @server_type == :mongos ? 'mongos' : 'mongod'
%>

pre-start script
  <% if @config[:dbpath] %>
  mkdir -p <%= @config[:dbpath] %>
  chown -R mongodb:mongodb <%= @config[:dbpath] %>
  <% end %>
  mkdir -p <%= File.dirname(@config[:logpath]) %>
end script

start on runlevel [2345]
stop on runlevel [06]

exec start-stop-daemon --start --quiet --chuid mongodb --exec  /usr/bin/<%= @binary %> -- <%= "--rest" if @config[:rest] %> <%= "--replSet #{@config[:replSet]}" if @config[:replSet] %> <%= %>  <%= "--shardsvr" if @config[:shard_server] %> <%= "--configsvr" if @server_type == :config_server %> <%= "--syncdelay #{@config[:syncdelay]}" if @config[:syncdelay] %> <%= "--configdb #{@configdb_server_list}" if @configdb_server_list && !@configdb_server_list.empty? %> --config <%= @config[:config] %>
